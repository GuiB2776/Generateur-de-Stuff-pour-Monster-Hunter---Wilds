const armorData = {
  "Espoir": {
    image: "img/hope-set-mhwilds-wiki-guide.png",
    parts: {
      "Tête":     { defense: 2, feu: 1, eau: 0, foudre: 1, glace: 0, dragon: 0, lien: "https://monsterhunterwilds.wiki.fextralife.com/Hope+Mask"  },
      "Plastron": { defense: 2, feu: 1, eau: 0, foudre: 1, glace: 0, dragon: 0, lien: "https://monsterhunterwilds.wiki.fextralife.com/Hope+Mask"  },
      "Gants":    { defense: 2, feu: 1, eau: 0, foudre: 1, glace: 0, dragon: 0, lien: "https://monsterhunterwilds.wiki.fextralife.com/Hope+Mask"  },
      "Tassette": { defense: 2, feu: 1, eau: 0, foudre: 1, glace: 0, dragon: 0, lien: "https://monsterhunterwilds.wiki.fextralife.com/Hope+Mask"  },
      "Grèves":   { defense: 2, feu: 1, eau: 0, foudre: 1, glace: 0, dragon: 0, lien: "https://monsterhunterwilds.wiki.fextralife.com/Hope+Mask"  }
    }
  },
  "Cuir": {
    image: "img/leather-set-mhwilds-wiki-guide.webp",
    parts: {
      "Tête":     { defense: 2, feu: 2, eau: 0, foudre: 0, glace: 0, dragon: 0, lien: "https://monsterhunterwilds.wiki.fextralife.com/Hope+Mask" },
      "Plastron": { defense: 2, feu: 2, eau: 0, foudre: 0, glace: 0, dragon: 0, lien: "https://monsterhunterwilds.wiki.fextralife.com/Hope+Mask" },
      "Gants":    { defense: 2, feu: 2, eau: 0, foudre: 0, glace: 0, dragon: 0, lien: "https://monsterhunterwilds.wiki.fextralife.com/Hope+Mask" },
      "Tassette": { defense: 2, feu: 2, eau: 0, foudre: 0, glace: 0, dragon: 0, lien: "https://monsterhunterwilds.wiki.fextralife.com/Hope+Mask" },
      "Grèves":   { defense: 2, feu: 2, eau: 0, foudre: 0, glace: 0, dragon: 0, lien: "https://monsterhunterwilds.wiki.fextralife.com/Hope+Mask" }
    }
  },
  "Mailles": {
    image: "img/chainmail-set-mhwilds-wiki-guide.webp",
    parts: {
      "Tête":     { defense: 2, feu: 0, eau: 2, foudre: 0, glace: 0, dragon: 0, lien: "https://monsterhunterwilds.wiki.fextralife.com/Hope+Mask" },
      "Plastron": { defense: 2, feu: 0, eau: 2, foudre: 0, glace: 0, dragon: 0, lien: "https://monsterhunterwilds.wiki.fextralife.com/Hope+Mask" },
      "Gants":    { defense: 2, feu: 0, eau: 2, foudre: 0, glace: 0, dragon: 0, lien: "https://monsterhunterwilds.wiki.fextralife.com/Hope+Mask" },
      "Tassette": { defense: 2, feu: 0, eau: 2, foudre: 0, glace: 0, dragon: 0, lien: "https://monsterhunterwilds.wiki.fextralife.com/Hope+Mask" },
      "Grèves":   { defense: 2, feu: 0, eau: 2, foudre: 0, glace: 0, dragon: 0, lien: "https://monsterhunterwilds.wiki.fextralife.com/Hope+Mask" }
    }
  },
  "Os": {
    image: "",
    parts: {
      "Tête":     { defense: 4, feu: 2, eau: 0, foudre: 2, glace: 0, dragon: 2 },
      "Plastron": { defense: 4, feu: 2, eau: 0, foudre: 2, glace: 0, dragon: 2 },
      "Gants":    { defense: 4, feu: 2, eau: 0, foudre: 2, glace: 0, dragon: 2 },
      "Tassette": { defense: 4, feu: 2, eau: 0, foudre: 2, glace: 0, dragon: 2 },
      "Grèves":   { defense: 4, feu: 2, eau: 0, foudre: 2, glace: 0, dragon: 2 }
    }
  },
  "Bulaqchi": {
    image: "",
    parts: {
      "Tête":     { defense: 4, feu: -4, eau: 1, foudre: 1, glace: -2, dragon: 4 }
    }
  },
  "Talioth": {
    image: "",
    parts: {
      "Gants":    { defense: 4, feu: 4, eau: -2, foudre: -2, glace: -2, dragon: 2 }
    }
  },
  "Chatacabra": {
    image: "",
    parts: {
      "Tête":     { defense: 6, feu: 1, eau: 2, foudre: -3, glace: -1, dragon: 1 },
      "Plastron": { defense: 6, feu: 1, eau: 2, foudre: -3, glace: -1, dragon: 1 },
      "Gants":    { defense: 6, feu: 1, eau: 2, foudre: -3, glace: -1, dragon: 1 },
      "Tassette": { defense: 6, feu: 1, eau: 2, foudre: -3, glace: -1, dragon: 1 },
      "Grèves":   { defense: 6, feu: 1, eau: 2, foudre: -3, glace: -1, dragon: 1 }
    }
  },
  "Quematrice": {
    image: "",
    parts: {
      "Tête":     { defense: 6, feu: 2, eau: -3, foudre: 0, glace: -1, dragon: 0 },
      "Plastron": { defense: 6, feu: 2, eau: -3, foudre: 0, glace: -1, dragon: 0 },
      "Gants":    { defense: 6, feu: 2, eau: -3, foudre: 0, glace: -1, dragon: 0 },
      "Tassette": { defense: 6, feu: 2, eau: -3, foudre: 0, glace: -1, dragon: 0 },
      "Grèves":   { defense: 6, feu: 2, eau: -3, foudre: 0, glace: -1, dragon: 0 }
    }
  },
  "Alliage": {
    image: "",
    parts: {
      "Tête":     { defense: 6, feu: -2, eau: 1, foudre: -2, glace: -2, dragon: 1 },
      "Plastron": { defense: 6, feu: -2, eau: 1, foudre: -2, glace: -2, dragon: 1 },
      "Gants":    { defense: 6, feu: -2, eau: 1, foudre: -2, glace: -2, dragon: 1 },
      "Tassette": { defense: 6, feu: -2, eau: 1, foudre: -2, glace: -2, dragon: 1 },
      "Grèves":   { defense: 6, feu: -2, eau: 1, foudre: -2, glace: -2, dragon: 1 }
    }
  },
  "Piragill": {
    image: "",
    parts: {
      "Grèves":   { defense: 4, feu: -3, eau: 4, foudre: -3, glace: 1, dragon: 1 }
    }
  },
  "Lala Barina": {
    image: "",
    parts: {
      "Tête":     { defense: 8, feu: -3, eau: 3, foudre: 0, glace: 0, dragon: 3 },
      "Plastron": { defense: 8, feu: -3, eau: 3, foudre: 0, glace: 0, dragon: 3 },
      "Gants":    { defense: 8, feu: -3, eau: 3, foudre: 0, glace: 0, dragon: 3 },
      "Tassette": { defense: 8, feu: -3, eau: 3, foudre: 0, glace: 0, dragon: 3 },
      "Grèves":   { defense: 8, feu: -3, eau: 3, foudre: 0, glace: 0, dragon: 3 }
    }
  },
  "Conga": {
    image: "",
    parts: {
      "Tête":     { defense: 8, feu: -3, eau: 1, foudre: 1, glace: -1, dragon: 2 },
      "Plastron": { defense: 8, feu: -3, eau: 1, foudre: 1, glace: -1, dragon: 2 },
      "Gants":    { defense: 8, feu: -3, eau: 1, foudre: 1, glace: -1, dragon: 2 },
      "Tassette": { defense: 8, feu: -3, eau: 1, foudre: 1, glace: -1, dragon: 2 },
      "Grèves":   { defense: 8, feu: -3, eau: 1, foudre: 1, glace: -1, dragon: 2 }
    }
  },
  "Balahara": {
    image: "",
    parts: {
      "Tête":     { defense: 12, feu: -1, eau: 2, foudre: -3, glace: 1, dragon: 1 },
      "Plastron": { defense: 12, feu: -1, eau: 2, foudre: -3, glace: 1, dragon: 1 },
      "Gants":    { defense: 12, feu: -1, eau: 2, foudre: -3, glace: 1, dragon: 1 },
      "Tassette": { defense: 12, feu: -1, eau: 2, foudre: -3, glace: 1, dragon: 1 },
      "Grèves":   { defense: 12, feu: -1, eau: 2, foudre: -3, glace: 1, dragon: 1 }
    }
  },
  "Doshaguma": {
    image: "",
    parts: {
      "Tête":     { defense: 16, feu: -3, eau: 2, foudre: -1, glace: -1, dragon: 4 },
      "Plastron": { defense: 16, feu: -3, eau: 2, foudre: -1, glace: -1, dragon: 4 },
      "Gants":    { defense: 16, feu: -3, eau: 2, foudre: -1, glace: -1, dragon: 4 },
      "Tassette": { defense: 16, feu: -3, eau: 2, foudre: -1, glace: -1, dragon: 4 },
      "Grèves":   { defense: 16, feu: -3, eau: 2, foudre: -1, glace: -1, dragon: 4 }
    }
  },
  "Lingot": {
    image: "",
    parts: {
      "Tête":     { defense: 16, feu: -2, eau: 0, foudre: 3, glace: -1, dragon: 0 },
      "Plastron": { defense: 16, feu: -2, eau: 0, foudre: 3, glace: -1, dragon: 0 },
      "Gants":    { defense: 16, feu: -2, eau: 0, foudre: 3, glace: -1, dragon: 0 },
      "Tassette": { defense: 16, feu: -2, eau: 0, foudre: 3, glace: -1, dragon: 0 },
      "Grèves":   { defense: 16, feu: -2, eau: 0, foudre: 3, glace: -1, dragon: 0 }
    }
  },
  "Kranodath": {
    image: "",
    parts: {
      "Plastron": { defense: 16, feu: 4, eau: -2, foudre: 0, glace: -2, dragon: 0 }
    }
  },
  "Rompopolo": {
    image: "",
    parts: {
      "Tête":     { defense: 18, feu: 0, eau: -3, foudre: 0, glace: 0, dragon: 1 },
      "Plastron": { defense: 18, feu: 0, eau: -3, foudre: 0, glace: 0, dragon: 1 },
      "Gants":    { defense: 18, feu: 0, eau: -3, foudre: 0, glace: 0, dragon: 1 },
      "Tassette": { defense: 18, feu: 0, eau: -3, foudre: 0, glace: 0, dragon: 1 },
      "Grèves":   { defense: 18, feu: 0, eau: -3, foudre: 0, glace: 0, dragon: 1 }
    }
  },
  "Nerscylla": {
    image: "",
    parts: {
      "Tête":     { defense: 20, feu: -2, eau: 2, foudre: -2, glace: 1, dragon: 2 },
      "Plastron": { defense: 20, feu: -2, eau: 2, foudre: -2, glace: 1, dragon: 2 },
      "Gants":    { defense: 20, feu: -2, eau: 2, foudre: -2, glace: 1, dragon: 2 },
      "Tassette": { defense: 20, feu: -2, eau: 2, foudre: -2, glace: 1, dragon: 2 },
      "Grèves":   { defense: 20, feu: -2, eau: 2, foudre: -2, glace: 1, dragon: 2 }
    }
  },
  "Hirabami": {
    image: "",
    parts: {
      "Tête":     { defense: 22, feu: -3, eau: 2, foudre: -2, glace: 3, dragon: 0 },
      "Plastron": { defense: 22, feu: -3, eau: 2, foudre: -2, glace: 3, dragon: 0 },
      "Gants":    { defense: 22, feu: -3, eau: 2, foudre: -2, glace: 3, dragon: 0 },
      "Tassette": { defense: 22, feu: -3, eau: 2, foudre: -2, glace: 3, dragon: 0 },
      "Grèves":   { defense: 22, feu: -3, eau: 2, foudre: -2, glace: 3, dragon: 0 }
    }
  },
  "Ajarakan": {
    image: "",
    parts: {
      "Tête":     { defense: 26, feu: 0, eau: -2, foudre: 4, glace: -3, dragon: 0 },
      "Plastron": { defense: 26, feu: 0, eau: -2, foudre: 4, glace: -3, dragon: 0 },
      "Gants":    { defense: 26, feu: 0, eau: -2, foudre: 4, glace: -3, dragon: 0 },
      "Tassette": { defense: 26, feu: 0, eau: -2, foudre: 4, glace: -3, dragon: 0 },
      "Grèves":   { defense: 26, feu: 0, eau: -2, foudre: 4, glace: -3, dragon: 0 }
    }
  },
  "Uth Duna": {
    image: "",
    parts: {
      "Tête":     { defense: 26, feu: -1, eau: 4, foudre: -3, glace: 0, dragon: 0 },
      "Plastron": { defense: 26, feu: -1, eau: 4, foudre: -3, glace: 0, dragon: 0 },
      "Gants":    { defense: 26, feu: -1, eau: 4, foudre: -3, glace: 0, dragon: 0 },
      "Tassette": { defense: 26, feu: -1, eau: 4, foudre: -3, glace: 0, dragon: 0 },
      "Grèves":   { defense: 26, feu: -1, eau: 4, foudre: -3, glace: 0, dragon: 0 }
    }
  }
};

const selectedGear = {};

function updateSelected() {
  const gearContainer = document.querySelector('.gear-parts');
  gearContainer.innerHTML = '';
  Object.entries(selectedGear).forEach(([part, data]) => {
    const div = document.createElement('div');
    div.className = 'piece';
    div.textContent = `${part} : ${data.set}`;
    gearContainer.appendChild(div);
  });
  updateTotals();
}

function updateTotals() {
  const stats = { defense: 0, feu: 0, eau: 0, foudre: 0, glace: 0, dragon: 0 };
  Object.values(selectedGear).forEach(data => {
    for (let key in stats) {
      stats[key] += data.stats[key];
    }
  });
  const display = 
    `
      <span class="def">Défense : &#8239 ${stats.defense}</span> &#8239
      <br>
      <span class="feu">Feu : &#8239 ${stats.feu}</span> &#8239
      <br>
      <span class="eau">Eau : &#8239 ${stats.eau}</span> &#8239
      <br>
      <span class="foudre">Foudre : &#8239 ${stats.foudre}</span> &#8239
      <br>
      <span class="glace">Glace : &#8239 ${stats.glace}</span> &#8239
      <br>
      <span class="dragon">Dragon : &#8239 ${stats.dragon}</span> &#8239 
    `;
  document.querySelector('.totals-stats').innerHTML = display;
}

function calcSetStats(parts) {
  const total = { defense: 0, feu: 0, eau: 0, foudre: 0, glace: 0, dragon: 0 };
  Object.values(parts).forEach(stats => {
    for (let key in total) total[key] += stats[key];
  });
  return `
    <span class="def">DEFENSE &#8239 : &#8239 &#8239 ${total.defense}</span>
    <br>
    <span class="feu">Feu &#8239 : &#8239 &#8239 ${total.feu}</span>
    <br>
    <span class="eau">Eau &#8239 : &#8239 &#8239 ${total.eau}</span>
    <br>
    <span class="foudre">Foudre &#8239 : &#8239 &#8239 ${total.foudre}</span>
    <br>
    <span class="glace">Glace &#8239 : &#8239 &#8239 ${total.glace}</span>
    <br>
    <span class="dragon">Dragon &#8239 : &#8239 &#8239 ${total.dragon}</span>`;
}

function createSetUI(setName, setData) {
  const container = document.createElement('div');
  container.className = 'set';

  const title = document.createElement('h3');
  title.textContent = setName;
  title.addEventListener('click', () => toggleSet(container));

  const statsLine = document.createElement('p');
  statsLine.className = 'global-stats';
  statsLine.innerHTML = calcSetStats(setData.parts);

  const image = document.createElement('img');
  image.src = setData.image || "https://via.placeholder.com/300x150?text=" + encodeURIComponent(setName);
  image.alt = `Image du set ${setName}`;

  const table = document.createElement('table');
  table.classList.add('armor-table');
  table.innerHTML = `
    <thead>
      <tr>
        <th>Partie</th>
        <th class="def">Déf</th>
        <th class="feu">Feu</th>
        <th class="eau">Eau</th>
        <th class="foudre">Foudre</th>
        <th class="glace">Glace</th>
        <th class="dragon">Dragon</th>
      </tr>
    </thead>
    <tbody></tbody>
  `;
  const tbody = table.querySelector('tbody');
  for (const [part, stats] of Object.entries(setData.parts)) {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${part}</td>
      <td class="def">${stats.defense}</td>
      <td class="feu">${stats.feu}</td>
      <td class="eau">${stats.eau}</td>
      <td class="foudre">${stats.foudre}</td>
      <td class="glace">${stats.glace}</td>
      <td class="dragon">${stats.dragon}</td>
    `;
    row.onclick = () => {
      selectedGear[part] = { set: setName, stats };
      updateSelected();
    };
    tbody.appendChild(row);
  }

  const body = document.createElement('div');
  body.className = 'accordion-body';
  body.appendChild(table);

  container.appendChild(title);
  container.appendChild(statsLine);
  container.appendChild(image);
  container.appendChild(body);
  document.getElementById('sets-container').appendChild(container);
}

function toggleSet(activeSet) {
  document.querySelectorAll('.set').forEach(set => {
    if (set !== activeSet) set.classList.remove('open');
  });
  activeSet.classList.toggle('open');
}

document.addEventListener('click', (e) => {
  const clickedInside = e.target.closest('.set');
  if (!clickedInside) {
    document.querySelectorAll('.set.open').forEach(el => el.classList.remove('open'));
  }
});

Object.entries(armorData).forEach(([setName, setData]) => {
  createSetUI(setName, setData);
});
